IDENTIFICATION DIVISION.
	PROGRAM-ID. AOC-2020-DAY-03.

ENVIRONMENT DIVISION.
	INPUT-OUTPUT SECTION.
	FILE-CONTROL.
		SELECT InputFile ASSIGN TO "input.txt"
			ORGANIZATION IS LINE SEQUENTIAL.

DATA DIVISION.
	FILE SECTION.
	FD InputFile.
	01 INPUT-FILE.
		05 INPUT-LINE PIC A(32).
	
	WORKING-STORAGE SECTION.
	01 WS-EOF PIC 9(1) VALUE 0.
	01 WS-INPUT.
		05 WS-INPUT-LINE PIC A(32).
	01 WS-TERRAIN.
		05 WS-TERRAIN-ROW OCCURS 323 TIMES INDEXED BY Y.
			10 WS-TERRAIN-POS OCCURS 32 TIMES INDEXED BY X.
				15 WS-TERRAIN-VALUE PIC A(1).
	01 WS-SLOPE-X PIC 9(1).
	01 WS-SLOPE-Y PIC 9(1).
	01 WS-TREE-COUNT PIC 9(16).
	01 WS-TREE-PRODUCT PIC 9(32).
	01 WS-FORMATTED-NUMBER PIC Z(12).

PROCEDURE DIVISION.
	
	OPEN INPUT InputFile.
		PERFORM VARYING Y FROM 1 BY 1 UNTIL WS-EOF=1
			READ InputFile INTO WS-INPUT-LINE
				AT END
					MOVE 1 TO WS-EOF
				NOT AT END
					MOVE WS-INPUT-LINE TO WS-TERRAIN-ROW(Y)
			END-READ
		END-PERFORM.
	CLOSE InputFile.
	
	MOVE 3 TO WS-SLOPE-X.
	MOVE 1 TO WS-SLOPE-Y.
	PERFORM COUNT-TREES-PARA.
	MOVE WS-TREE-COUNT TO WS-FORMATTED-NUMBER.
	DISPLAY "Part 1 answer: " WS-FORMATTED-NUMBER.
	
	MOVE WS-TREE-COUNT TO WS-TREE-PRODUCT.
	MOVE 5 TO WS-SLOPE-X
	PERFORM COUNT-TREES-PARA.
	
	MOVE 7 TO WS-SLOPE-X.
	PERFORM COUNT-TREES-PARA.
	
	MOVE 1 TO WS-SLOPE-X.
	PERFORM COUNT-TREES-PARA.
	
	MOVE 2 TO WS-SLOPE-Y.
	PERFORM COUNT-TREES-PARA.
	
	MOVE WS-TREE-PRODUCT TO WS-FORMATTED-NUMBER.
	DISPLAY "Part 2 answer: " WS-FORMATTED-NUMBER.
	STOP RUN.
	
	COUNT-TREES-PARA.
	SET X Y TO 1.
	MOVE 0 TO WS-TREE-COUNT.
	PERFORM UNTIL Y>323
		IF WS-TERRAIN-POS(Y, X)="#" THEN
			ADD 1 TO WS-TREE-COUNT
		END-IF
		SET X UP BY WS-SLOPE-X
		IF X>31 THEN
			SET X DOWN BY 31
		END-IF
		SET Y UP BY WS-SLOPE-Y
	END-PERFORM.
	MULTIPLY WS-TREE-COUNT BY WS-TREE-PRODUCT.
